

# Objectif

monitorer sans interrompre un trafic avec des vlans taggés
ajouter une interface a son PC dans le vlan de son choix




# conf du vieux swtich 3com 

vlan 1 :
- 192.168.100.77
- ne fonctionne que quand kali_tower a l'interface usb-ethernet de branchée

vlan 2 :
- untag sur les ports 2 et 11
- tag sur le port 12
- pas d'interface dans le vlan 2



# Conf du swtich4200


# perte de conf a chaque demarrage se brancher dessus en serie avec
minicom conf3com

system-view

interface Ethernet 1/0/12
port link-type trunk
port trunk permit vlan 2
quit

vlan 2
port Ethernet 1/0/2
port Ethernet 1/0/11
quit


# conf du raspberry PI blanc 	
- 192.168.253.10 sur le port 11 du switch 4200

# conf du Kali_tower 
- 192.168.253.11 sur le port 11 du vieux 3com (vlan 2)
- 192.168.100.33 sur le vieux 3com (vlan 1) quand 'linterface usb-ethernet est branchée

# conf du pc en position de MITM
- 192.168.253.12 sur le bridge0 (permet de pinguer)
- [pas d'ip] sur eth0
- [pas d'ip] sur eth1


# Mettre sarasvati en man ip the middle et monitorer le trafic sans l'interompre

- monter un bridge avec network manager et nmcli

nmcli con show | grep  bridge0
nmcli con up 37dd44bf-794a-42fe-83c1-44a5352f9e41
nmcli con up 66607e25-59ce-4a4a-8841-2ad1e78db98e
nmcli con up 7a399367-3fc6-46da-bc9b-a3ac634f9115


- passer les interfaces en mode promiscus ? (a priori pas utile, mais ne mange pas de pain)

- desactiver le filtrage iptables pour le bridge : 
https://superuser.com/questions/1211852/why-linux-bridge-doesnt-work
echo 0 > /proc/sys/net/bridge/bridge-nf-call-iptables

Fonctione !

# Le trafic passe, y compris avec des vlans. Les tags des vlans sont visibles dans wireshark.

# Les machines dont le traffic est visible sans vlan sont pingables depuis la machine MITM

#TODO 
# Donner a sarasvati une @ip dans le vlan 2 et pinguer aussi !

https://medium.com/@kbidarkar/configuring-bridges-and-vlans-using-nmcli-8cb79f45d3a6






